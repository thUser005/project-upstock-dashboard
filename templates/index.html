<!doctype html>
<html>
  <head>
    <title>Upstox GTT Trading</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="/static/css/style.css" rel="stylesheet" />
  </head>

  <body>
    <div class="container-fluid px-2 py-2">
      <!-- HEADER -->
      <div class="trading-card mb-2 sticky-top bg-dark header-bar">
        <div class="card-body px-4 py-2">
          <div class="row align-items-center">
            <!-- LEFT: TITLE -->
            <div class="col-md-6">
              <h2 class="text-light">Selected Index:</h2>
              <div
                id="selectedIndexLabel"
                class="text-info text-center fw-bold fs-3"
              >
                NIFTY
                <span id="indexLivePrice" class="ms-2 text-success">--</span>
              </div>
            </div>

            <!-- RIGHT: BALANCE -->
            <div class="col-md-3 text-end">
              <div class="balance-display d-inline-block">
                <div class="stat-label text-center mb-1">AVAILABLE BALANCE</div>
                <div class="balance-amount" id="availableBalance">‚Çπ0</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-2">
        <div class="col-lg-12">
          <!-- SEARCH AND INSTRUMENTS -->
          <div class="trading-card mb-2">
            <div class="card-body p-4">
              <div
                class="d-flex align-items-center justify-content-between mb-3"
              >
                <!-- LEFT: TITLE -->
                <h3 class="section-header text-white m-0">
                  Search Instruments
                </h3>

                <!-- RIGHT: INDEX SELECTOR -->
                <div class="d-flex gap-3">
                  <button id="btnNifty" class="index-box active">NIFTY</button>
                  <button id="btnSensex" class="index-box">SENSEX</button>
                </div>
              </div>

              <div class="input-group text-light input-group-lg mb-2">
                <span
                  class="input-group-text trading-input"
                  style="border-right: none"
                >
                  <span style="color: #00ff88">üîç</span>
                </span>
                <input
                  id="searchBox"
                  class="form-control bg-light text-dark trading-input"
                  placeholder="Enter strike price (e.g., 92900) or symbol..."
                  type="text"
                  style="border-left: none"
                />
              </div>

              <!-- INSTRUMENTS TABLES -->
              <div class="row g-2">
                <!-- CALL OPTIONS -->
                <div class="col-md-6">
                  <div
                    class="d-flex align-items-center justify-content-between mb-3"
                  >
                    <h4 class="text-white mb-0">Call Options</h4>
                    <span class="call-badge">CE</span>
                  </div>

                  <!-- EXPIRY RADIO FILTER -->
                  <div id="expiryFilters" class="mb-3"></div>
                  <div
                    class="table-responsive"
                    style="max-height: 800px; overflow-y: auto"
                  >
                    <table class="table table-dark table-hover mb-0">
                      <thead>
                        <tr>
                          <th class="text-light">Strike</th>
                          <th class="text-light">Expiry</th>
                          <th class="text-light">Lot</th>
                          <th class="text-light"></th>
                        </tr>
                      </thead>
                      <tbody id="ceBody">
                        <tr>
                          <td colspan="4" class="text-center text-muted py-5">
                            <div class="py-3">
                              <span style="color: #8a8aff"
                                >Select index and start typing to
                                search...</span
                              >
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- PUT OPTIONS -->
                <div class="col-md-6">
                  <div
                    class="d-flex align-items-center justify-content-between mb-3"
                  >
                    <h4 class="text-white mb-0">Put Options</h4>
                    <span class="put-badge">PE</span>
                  </div>
                  <div
                    class="table-responsive"
                    style="max-height: 800px; overflow-y: auto"
                  >
                    <table class="table table-dark table-hover mb-0">
                      <thead>
                        <tr>
                          <th class="text-light">Strike</th>
                          <th class="text-light">Expiry</th>
                          <th class="text-light">Lot</th>
                          <th class="text-light"></th>
                        </tr>
                      </thead>
                      <tbody id="peBody">
                        <tr>
                          <td colspan="4" class="text-center text-muted py-5">
                            <div class="py-3">
                              <span style="color: #8a8aff"
                                >Select index and start typing to
                                search...</span
                              >
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row g-2">
        <div class="col-lg-4">
          <!-- TRADING CALCULATOR -->
          <div class="trading-card mb-2">
            <div class="card-body p-4">
              <h3 class="section-header text-white">Trading Calculator</h3>
              <div class="row g-3">
                <div class="col-12">
                  <div class="stat-card">
                    <div class="stat-label text-center">Live LTP</div>
                    <div class="stat-value" id="ltpValue">‚Çπ0.00</div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="stat-card">
                    <div class="stat-label text-center">Max Lots</div>
                    <div class="stat-value" id="maxLots">0</div>
                  </div>
                </div>
                <!-- <div class="col-12">
                  <div class="stat-card">
                    <div class="stat-label text-center">Margin Required</div>
                    <div class="stat-value text-danger" id="marginRequired">
                      ‚Çπ0
                    </div>
                  </div>
                </div> -->
                <div class="col-12">
                  <div class="stat-card">
                    <div class="stat-label text-center">Capital Required</div>
                    <div class="stat-value" id="positionValue">‚Çπ0</div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="stat-card">
                    <div class="stat-label text-center">
                      Capital Utilization
                    </div>
                    <div class="d-flex align-items-center">
                      <div
                        class="progress flex-grow-1 me-3"
                        style="height: 10px"
                      >
                        <div
                          class="progress-bar"
                          id="capitalBar"
                          style="
                            width: 0%;
                            background: linear-gradient(
                              90deg,
                              #ff9500,
                              #ff7b00
                            );
                          "
                        ></div>
                      </div>
                      <span class="stat-value fs-5" id="capitalPercent"
                        >0%</span
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-8">
          <!-- ORDER FORM -->
          <div class="trading-card">
            <div class="card-body p-4">
              <h3 class="section-header text-white">Place GTT Order</h3>
              <form id="gttForm">
                <!-- SELECTED INSTRUMENT INFO -->
                <div class="row g-3 mb-2">
                  <div class="col-md-6">
                    <label class="form-label text-light fw-bold"
                      >Instrument Token</label
                    >
                    <input
                      id="instrumentToken"
                      name="instrument_token"
                      class="form-control trading-input"
                      placeholder="Will auto-fill from selection"
                      readonly
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Lot Size</label
                    >
                    <input
                      id="lotSize"
                      class="form-control trading-input text-center"
                      readonly
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Live LTP</label
                    >
                    <div
                      class="trading-input text-center fw-bold ltp-indicator"
                      id="liveLtpDisplay"
                    >
                      ‚Çπ0.00
                    </div>
                  </div>
                </div>

                <!-- QUANTITY AND PRICES -->
                <div class="row g-2">
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold">Lots</label>
                    <input
                      type="number"
                      id="lotsInput"
                      class="form-control trading-input text-center"
                      value="1"
                      min="1"
                      onchange="syncQuantityFromLots()"
                    />
                  </div>

                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Entry Price</label
                    >
                    <input
                      id="entryPrice"
                      type="number"
                      step="0.05"
                      name="entry_price"
                      class="form-control trading-input text-center"
                      placeholder="Auto from LTP"
                      onchange="updateMarginCalculations()"
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Target Price</label
                    >
                    <input
                      type="number"
                      step="0.05"
                      id="targetPrice"
                      name="target_price"
                      class="form-control trading-input text-center"
                      placeholder="Set target"
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Stop Loss</label
                    >
                    <input
                      type="number"
                      step="0.05"
                      id="stopLossPrice"
                      name="stoploss_price"
                      class="form-control trading-input text-center"
                      placeholder="Set stop loss"
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Quantity</label
                    >
                    <input
                      type="number"
                      id="quantityInput"
                      name="quantity"
                      class="form-control trading-input text-center"
                      readonly
                    />
                  </div>
                  <div class="col-md-3">
                    <label class="form-label text-light fw-bold"
                      >Instrument Id</label
                    >
                    <input
                      type="text"
                      id="insInput"
                      class="form-control trading-input"
                      readonly
                    />
                  </div>
                </div>

                <!-- SUBMIT BUTTON -->
                <div class="text-center mt-5">
                  <button type="submit" class="action-btn btn px-5">
                    üöÄ PLACE GTT ORDER
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="row g-2">
        <div class="col-lg-12">
          <!-- P&L PROJECTION -->
          <div class="trading-card">
            <div class="card-body p-4">
              <h3 class="section-header text-white">P&L Projection</h3>
              <div class="pnl-table mb-2">
                <table class="table table-dark mb-0">
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Points</th>
                      <th>P&L</th>
                    </tr>
                  </thead>
                  <tbody id="pnlBody">
                    <tr>
                      <td colspan="3" class="text-center py-2">
                        <span class="text-muted"
                          >Select an instrument to view P&L</span
                        >
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="mt-4">
                <div
                  class="d-flex justify-content-between align-items-center mb-2"
                >
                  <div class="d-flex align-items-center">
                    <div
                      class="rounded-circle me-2"
                      style="width: 12px; height: 12px; background: #00ff88"
                    ></div>
                    <span class="text-light fw-bold">Profit Zone</span>
                  </div>
                  <div class="d-flex align-items-center">
                    <div
                      class="rounded-circle me-2"
                      style="width: 12px; height: 12px; background: #ff5555"
                    ></div>
                    <span class="text-light fw-bold">Loss Zone</span>
                  </div>
                </div>
                <div class="pnl-progress">
                  <div
                    class="profit-bar"
                    id="profitBar"
                    style="width: 50%; height: 100%"
                  ></div>
                  <div
                    class="loss-bar"
                    id="lossBar"
                    style="width: 50%; height: 100%"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
      <div id="indexToast" class="toast custom-toast">
        <div class="d-flex align-items-center">
          <div class="toast-body text-white fw-bold" id="toastMsg"></div>
          <button
            type="button"
            class="btn-close btn-close-white me-2"
            data-bs-dismiss="toast"
          ></button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/get_base_url.js"></script>
    <script src="/static/js/script.js"></script>
  </body>
</html>
